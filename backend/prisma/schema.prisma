// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  uuid         String         @unique
  createdAt    DateTime       @default(now()) @map("createdAt")
  updatedAt    DateTime       @updatedAt @map("updatedAt")

  email        String         @unique
  phone_number String         @unique
  birth_day    String
  town         String
  first_name   String      
  second_name  String      
  password     String         @unique
  avatarPath   String         @default("default-avatar.png") @map("avatar_path")
  verified     Boolean?
  verifyToken  String?        @unique
  role         EnumRoleOfUser @default(DEFAULT_USER)
  orders       Order[]
  favorites    Product[]
  reviews      Review[]
  clicks       UserClick[]
}

model Product {
  uuid          String        @unique
  createdAt     DateTime      @default(now()) @map("createdAt")
  updatedAt     DateTime      @updatedAt @map("updatedAt")

  name          String        @unique
  slug          String        @unique
  description   String
  peculiarities String?
  quantity      Int
  price         Int
  discount      Int
  images        String[]      @default(["default-product-photo.png"])

  categoryUuid  String?       @map("categoryUuid")
  userUuid      String?       @map("userUuid")
  subcategoryUuid String?     @map("subcategoryUuid")

  orderItems    OrderItem[]
  reviews       Review[]
  photoFiles    PhotoFile[]
  clicks        UserClick[]

  category      Category?     @relation(fields: [categoryUuid], references: [uuid])
  user          User?         @relation(fields: [userUuid], references: [uuid])
  subcategory   Subcategory?  @relation(fields: [subcategoryUuid], references: [uuid])
}

model UserClick {
  uuid          String       @unique
  clickedAt     DateTime     @default(now())
  userUuid      String
  productUuid   String
  
  product       Product      @relation(fields: [productUuid], references: [uuid])
  user          User         @relation(fields: [userUuid], references: [uuid])
}


model PhotoFile {
  uuid         String        @unique
  createdAt    DateTime      @default(now()) @map("createdAt")
  updatedAt    DateTime      @updatedAt @map("updatedAt")

  url          String        @unique
  filename     String
  originalname String
  mimetype     String
  size         Int
  path         String
  productUuid  String?       @map("productUuid")
  product      Product?      @relation(fields: [productUuid], references: [uuid])
  categoryUuid String?      @map("categoryUuid") @unique
}

model Category {
  uuid        String         @unique
  createdAt   DateTime       @default(now()) @map("createdAt")
  updatedAt   DateTime       @updatedAt @map("updatedAt")

  icon        String?        @default("default-product-photo.png")
  name        String         @unique
  slug        String         @unique
  subcategory Subcategory[]
  products    Product[]
}

model Subcategory {
  uuid        String         @unique
  createdAt   DateTime       @default(now()) @map("createdAt")
  updatedAt   DateTime       @updatedAt @map("updatedAt")

  name        String
  slug        String         @unique

  categoryUuid String?       @map("categoryUuid")
  category     Category?     @relation(fields: [categoryUuid], references: [uuid])
  products     Product[]
}

model Review {
  uuid        String         @unique
  createdAt   DateTime       @default(now()) @map("createdAt")
  updatedAt   DateTime       @updatedAt @map("updatedAt")

  rating      Int
  text        String
  userUuid    String         @map("userUuid")
  productUuid String?        @map("productUuid")
  product     Product?       @relation(fields: [productUuid], references: [uuid])
  user        User           @relation(fields: [userUuid], references: [uuid])
}

model Order {
  uuid        String         @unique
  createdAt   DateTime       @default(now()) @map("createdAt")
  updatedAt   DateTime       @updatedAt @map("updatedAt")

  orderId      String        @unique
  addressLine1 String
  addressLine2 String?
  postalCode   String?
  comment      String?

  status      EnumOrderItemStatus @default(Pending)

  items       OrderItem[]
  total       Int

  user        User           @relation(fields: [userUuid], references: [uuid])
  userUuid    String         @map("userUuid")
}

model OrderItem {
  uuid        String         @unique
  createdAt   DateTime       @default(now()) @map("createdAt")
  updatedAt   DateTime       @updatedAt @map("updatedAt")

  quantity    Int
  price       Int

  order       Order?         @relation(fields: [orderUuid], references: [uuid])
  orderUuid   String?        @map("orderUuid")

  product     Product        @relation(fields: [productUuid], references: [uuid])
  productUuid String         @map("productUuid")

  @@map("Order_item")
}

enum EnumOrderItemStatus {
  Pending
  Payed
  In_Delivery
  Delivered
  Canceled
}

enum EnumRoleOfUser {
  ADMIN
  DEFAULT_USER
  MANAGER
  COURIER
}